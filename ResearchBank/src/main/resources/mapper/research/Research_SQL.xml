<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="research">
	<insert id="insertSurvey" parameterType="hashmap">
     <![CDATA[
         INSERT INTO SURVEY_LIST ( SURVEY_IDX
                            , REG_DATE
                            , DEADLINE_DATE
                            , SURVEY_POINT
                            , MAXIMUM_PART
                            , CURRENT_PART
                            , ISREPLY
                            , ISOPEN
                            , SURVEY_SUBJECT
                            , MEMBER_ID) VALUES ( SURVEY_SEQ.nextval
                                                 , SYSDATE
                                                 , #{deadline_date}
                                                 , #{survey_point}
                                                 , #{maximum_part}
                                                 , 0
                                                 , 0
                                                 , 0
                                                 , #{survey_subject}
                                                 , '123123')
     ]]>
     <selectKey keyProperty="survey_seq" resultType="int">
     	SELECT SURVEY_SEQ.CURRVAL FROM DUAL
     </selectKey>
    </insert>
    <insert id="insertCon" parameterType="hashmap">
   	INSERT INTO CONDITION_LIST (SURVEY_IDX
                         , CONDITION_IDX
                         , CONDITION_ORDER
                         , CONDITION_SUBJECT
                         , CON_OPT0
                         , CON_OPT1
                         , CON_OPT2
                         , CON_OPT3
                         , CON_OPT4
                         ) values ( #{survey_idx}
                                  , CONDITION_SEQ.nextval
                                  , #{condition_order}
                                  , #{condition_subject}
                                  <foreach collection="con_opt" item="item">
                                  , #{item}
                                  </foreach>
                                  <if test="con_opt.size == 2">
                                  ,null ,null ,null
                                  </if>
                                  <if test="con_opt.size == 3">
                                  ,null ,null
                                  </if>
                                  <if test="con_opt.size == 4">
                                  ,null
                                  </if>
                                  )	
    
	</insert>
	
    <insert id="insertQue" parameterType="hashmap">
   	INSERT INTO QUESTION_LIST (SURVEY_IDX
                         	, QUESTION_IDX
                         	, QUESTION_ORDER
                        	, QUESTION_SUBJECT
                         	, QUE_OPT0
                         	, QUE_OPT1
                         	, QUE_OPT2
                         	, QUE_OPT3
                         	, QUE_OPT4
                         	) values ( #{survey_idx}
                                  	 , QUESTION_SEQ.nextval
                                  	 , #{question_order}
                                  	 , #{question_subject}
                                  	 <foreach collection="que_opt" item="item">
                                  	 , #{item}
                                  	 </foreach>
                                  	 <if test="que_opt.size == 2">
                                  	 ,null ,null ,null
                                  	 </if>
                                  	 <if test="que_opt.size == 3">
                                  	 ,null ,null
                                  	 </if>
                                  	 <if test="que_opt.size == 4">
                                  	 ,null
                                  	 </if>
                                   	 )	
    
	</insert>
	<select id="selectList" parameterType="hashmap" resultType="hashmap">
		SELECT l.survey_subject 	as survey_subject 
    		 , l.maximum_part		as maximum_part
     		 , l.current_part 		as current_part
    		 , l.deadline_date 		as deadline_date 
    		 , l.member_id 			as member_id
    		 , l.survey_idx 		as survey_idx
    		 , l.survey_point       as survey_point 
    		 , r.member_nickname 	as member_nickname
       		   FROM survey_list l
          		  , member_list r
          			WHERE l.member_id = r.member_id
          		    <if test="isSearch != null">
          		    	<if test="searchNum==0">
          		    		AND l.survey_subject like '%' ||  #{isSearch} || '%'
          		    	</if>
          		    	<if test="searchNum==1">
          		    		AND r.member_nickname like '%' ||  #{isSearch} || '%'
          		    	</if>
          		    	
          		    </if>
          		    order by l.survey_subject desc
	</select>
	<select id="selectOne" parameterType="int" resultType="hashmap">
		SELECT survey_subject FROM survey_list WHERE survey_idx = #{survey_idx}
			 
	</select>
	<select id="selectCon" parameterType="int" resultType="hashmap">
		SELECT condition_idx
			 , condition_order
			 , condition_subject
			 , con_opt0
			 , con_opt1
			 , con_opt2
			 , con_opt3
			 , con_opt4			 
			 FROM condition_list WHERE survey_idx = #{survey_idx}
			 ORDER BY condition_order ASC
	</select>
	<select id="selectQue" parameterType="int" resultType="hashmap">
		SELECT question_idx
			 , question_order
			 , question_subject
			 , que_opt0
			 , que_opt1
			 , que_opt2
			 , que_opt3
			 , que_opt4			
			 FROM question_list WHERE survey_idx = #{survey_idx}
			 ORDER BY question_order ASC
	</select>
	<insert id="part" parameterType="hashmap">
		INSERT INTO participate_list ( survey_idx
									 , partmember_id
                             		 <if test="condition0 != null">
                                     , condition0
                                     </if>
                             		 <if test="condition1 != null">
                                     , condition1
                                     </if>
                                     <if test="condition2 != null">
                                     , condition2
                                     </if>
                                     <if test="condition3 != null">
                                     , condition3
                                     </if>
                                     <if test="condition4 != null">
                                     , condition4
                                     </if>
                             		 ) values ( #{survey_idx}                      		 		
                             		 			, #{partmember_id}
                             		 			<if test="condition0 != null">
                                     		  	, #{condition0}
                                     		  	</if>
                                     		  	<if test="condition1 != null">
                                     		  	, #{condition1}
                                     		  	</if>
                                     		  	<if test="condition2 != null">
                                     		  	, #{condition2}
                                     		  	</if>
                                     		  	<if test="condition3 != null">
                                     		  	, #{condition3}
                                     		  	</if>
                                     		  	<if test="condition4 != null">
                                     		  	, #{condition4}
                                     		  	</if>
                                      		  	)
    	
    	
    	
	</insert>
	<insert id="partNon" parameterType="hashmap">
		INSERT INTO participate_list ( survey_idx
									 , partmember_id
                             		 <if test="condition0 != null">
                                     , condition0
                                     </if>
                             		 <if test="condition1 != null">
                                     , condition1
                                     </if>
                                     <if test="condition2 != null">
                                     , condition2
                                     </if>
                                     <if test="condition3 != null">
                                     , condition3
                                     </if>
                                     <if test="condition4 != null">
                                     , condition4
                                     </if>
                             		 ) values ( #{survey_idx}                      		 		
                             		 			, PARTMEMBER_SEQ.nextval
                             		 			<if test="condition0 != null">
                                     		  	, #{condition0}
                                     		  	</if>
                                     		  	<if test="condition1 != null">
                                     		  	, #{condition1}
                                     		  	</if>
                                     		  	<if test="condition2 != null">
                                     		  	, #{condition2}
                                     		  	</if>
                                     		  	<if test="condition3 != null">
                                     		  	, #{condition3}
                                     		  	</if>
                                     		  	<if test="condition4 != null">
                                     		  	, #{condition4}
                                     		  	</if>
                                      		  	)
	
		<selectKey keyProperty="partmember_idx" resultType="int">
     		SELECT PARTMEMBER_SEQ.CURRVAL FROM DUAL
    	</selectKey>
	</insert>
	<insert id="answer" parameterType="hashmap">
		INSERT INTO answer ( question_idx
                   		   , answer
                     	   , partmember_id
                   		   ) values ( #{idx}
                   		   			, #{answer}
                   		   			, #{partmember_id}
                   		   			)
	</insert>
</mapper>

